---
title: 集群环境状态图
---
stateDiagram-v2
    %% 主图 - 集群环境状态图
    state "环境创建状态" as envCreate
    state "集群创建状态" as clusterCreate
    state "服务部署状态" as serviceDeploy
    state "服务审批状态" as serviceApprove
    state "环境部署完成" as envDeploy
    
    [*] --> envCreate
    envCreate --> clusterCreate: 创建成功
    clusterCreate --> serviceDeploy: 外部服务部署
    serviceDeploy --> serviceApprove: 部署成功
    serviceApprove --> envDeploy: 审批通过
    
    %% 环境验证状态和环境部署状态之间的关系
    envCreate --> envDeploy: 重启部署
    serviceApprove --> clusterCreate: 重新创建

    %% 子图 - 环境创建状态
    state 环境创建状态验证 {
        state "未验证" as notVerified
        state "验证中" as verifying
        
        notVerified --> verifying: 触发验证流程
        verifying --> notVerified: 验证失败
    }
    
    %% 子图 - 使用状态
    state 使用状态 {
        state "未使用" as notUsed
        state "使用中" as using
        state "运行中" as running
        
        notUsed --> using: 开始使用
        using --> running: 启动成功
        running --> notUsed: 回收资源
    }
    
    %% 子图 - 容器/应用状态
    state 容器应用状态 {
        state "未开机" as notStarted
        state "开机中" as starting
        state "运行中" as running2
        state "关机中" as stopping
        state "关机状态" as stopped
        state "已销毁" as destroyed
        
        notStarted --> starting: 触发开机
        starting --> running2: 开机成功
        running2 --> stopping: 开始关机
        stopping --> stopped: 关机成功
        stopped --> notStarted: 重启流程
        stopped --> destroyed: 销毁
    }

    %% 状态注释
    note right of 环境创建状态验证
        当环境创建状态为非服务部署成功状态时
        环境验证状态、使用状态和开关机状态分别为默认的
        "未验证"、"未使用"和"未开机"
        
        当环境创建状态为服务部署成功状态时
        环境验证状态、使用状态和开关机状态分别为默认的
        "未验证"、"使用中"和"运行中"
    end note
    
    note left of 环境创建状态验证
        当用户执行自动化用例时，环境验证状态从"未验证"转换为"验证中"
    end note
    
    note right of 使用状态
        当环境创建状态为服务部署成功时，使用状态自动设置为"使用中"
    end note
    
    note right of 容器应用状态
        当用户触发开机时，开关机状态从"未开机"转换为"开机中"
        当环境创建状态为服务部署成功时，开关机状态自动设置为"运行中"
    end note 
